---
name: Authentication System
status: open
created: 2026-02-01T19:27:06Z
updated: 2026-02-01T19:36:29Z
github: https://github.com/Enoshraju7-prog/bits-campus-connect/issues/6
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: Authentication System

## Description
Build the complete authentication system with BITS email validation, OTP verification via Resend, JWT token management (access + refresh), and protected route middleware. Includes both backend API endpoints and frontend auth pages (login, register, verify OTP, forgot/reset password).

## Acceptance Criteria
- [ ] POST /api/v1/auth/register - validates BITS email regex, checks uniqueness, hashes password (bcrypt cost 12), sends OTP via Resend
- [ ] POST /api/v1/auth/verify-email - verifies 6-digit OTP (stored in Redis, 10min expiry, max 3 resends/hour)
- [ ] POST /api/v1/auth/login - validates credentials, returns JWT access token (15min) + refresh token (7 days) in HTTP-only cookies
- [ ] POST /api/v1/auth/logout - invalidates refresh token in Redis
- [ ] POST /api/v1/auth/refresh - issues new access token from valid refresh token
- [ ] POST /api/v1/auth/forgot-password - sends password reset OTP to verified email
- [ ] POST /api/v1/auth/reset-password - validates OTP and updates password
- [ ] Auth middleware extracts and verifies JWT from Authorization header or cookie
- [ ] Rate limiting: 10 req/min on auth endpoints, 100 req/min on general API
- [ ] Frontend: Login page, Register page, OTP verification page, Forgot password flow
- [ ] Campus auto-detected from email domain during registration
- [ ] Zod validation schemas in packages/shared for all auth requests
- [ ] Standard API response format: { success: true, data: {} } or { success: false, error: {} }

## Technical Details
- Email regex: /^[a-z]\d{8}@(pilani|goa|hyderabad|dubai)\.bits-pilani\.ac\.in$/i
- bcrypt for password hashing (cost factor 12)
- jsonwebtoken for JWT signing/verification
- Redis for OTP storage (key: otp:{email}, TTL: 600s) and refresh token whitelist
- Resend SDK for email delivery
- express-rate-limit with Redis store for rate limiting
- HTTP-only, Secure, SameSite=Strict cookies for tokens
- Auth middleware at apps/api/src/middleware/auth.ts
- Error handler middleware with proper status codes

## Dependencies
- [ ] Task 001: Project foundation
- [ ] Task 002: Database schema (users table, Prisma client)

## Effort Estimate
- Size: L
- Hours: 16-20
- Parallel: false (blocks all authenticated features)

## Definition of Done
- [ ] Full registration flow works: register -> receive OTP -> verify -> logged in
- [ ] Login/logout cycle works with JWT tokens
- [ ] Protected routes return 401 without valid token
- [ ] Rate limiting blocks excessive auth requests
- [ ] Password reset flow works end-to-end
- [ ] Frontend auth pages are functional and styled
