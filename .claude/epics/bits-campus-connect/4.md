---
name: Database Schema & Prisma Setup
status: closed
created: 2026-02-01T19:27:06Z
updated: 2026-02-02T13:54:36Z
github: https://github.com/Enoshraju7-prog/bits-campus-connect/issues/4
depends_on: [2]
parallel: false
conflicts_with: []
---

# Task: Database Schema & Prisma Setup

## Description
Implement the complete PostgreSQL database schema using Prisma ORM. Create all 16 tables defined in the PRD, set up seed data for interests and default communities, configure Redis connection, and export generated Prisma types to the shared package.

## Acceptance Criteria
- [ ] Prisma schema with all 16 tables: users, user_interests, interests, connections, conversations, conversation_participants, messages, stories, story_views, communities, community_members, community_posts, post_votes, comments, feed_posts, feed_post_media, feed_post_likes, feed_post_comments, notifications, blocks, reports
- [ ] All enums defined: Campus, ConnectionStatus, ConversationRole, MessageType, ContentType, PostType, CommunityRole, VoteType, FeedPostType, MediaType, ReportType, ReportStatus
- [ ] Proper indexes on: email, username, conversation lookups, feed ordering, community post scoring, created_at timestamps
- [ ] Seed script with 60+ predefined interests across 8 categories and 19 default communities
- [ ] Migration files generated and tested
- [ ] Prisma client generation integrated into build scripts
- [ ] Redis client utility configured in apps/api
- [ ] Database connection with connection pooling

## Technical Details
- Prisma schema in apps/api/prisma/schema.prisma
- Use UUID for all primary keys (via @default(uuid()))
- Soft deletes via is_deleted boolean on messages, posts, comments
- JSONB for notifications.data field
- Composite unique constraints on: user_interests, conversation_participants, post_votes, feed_post_likes, story_views, blocks
- Redis using ioredis package with connection URL from env
- Seed file: apps/api/prisma/seed.ts

## Dependencies
- [ ] Task 001: Project foundation must be complete

## Effort Estimate
- Size: M
- Hours: 8-12
- Parallel: false (blocks all feature tasks)

## Definition of Done
- [ ] `pnpm db:generate` generates Prisma client
- [ ] `pnpm db:migrate` applies all migrations successfully
- [ ] `pnpm db:studio` opens Prisma Studio with all tables visible
- [ ] Seed data populates interests and communities tables
- [ ] Redis connection established and tested
- [ ] Prisma types accessible from packages/shared
