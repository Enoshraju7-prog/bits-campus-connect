---
name: Stories & Feed
status: open
created: 2026-02-01T19:27:06Z
updated: 2026-02-01T19:36:29Z
github: https://github.com/Enoshraju7-prog/bits-campus-connect/issues/3
depends_on: [2, 4, 6, 8]
parallel: true
conflicts_with: []
---

# Task: Stories & Feed

## Description
Build the ephemeral stories system (24-hour auto-expiring content) and the personal feed (Instagram/Facebook-style posts with likes and comments). Includes image upload, story viewer with view tracking, feed pagination, and all associated UI components.

## Acceptance Criteria
- [ ] POST /api/v1/stories - create story (image upload via R2 or text with background color)
- [ ] GET /api/v1/stories - get all active stories from connections, grouped by user
- [ ] GET /api/v1/stories/me - get own active stories
- [ ] DELETE /api/v1/stories/:id - delete own story
- [ ] POST /api/v1/stories/:id/view - record story view (idempotent per user)
- [ ] GET /api/v1/stories/:id/views - get viewer list (story owner only)
- [ ] Cron job: delete expired stories (created_at + 24h < now) every 15 minutes
- [ ] Max 10 stories per user per 24 hours
- [ ] POST /api/v1/feed/posts - create feed post (text, image with up to 4 photos, achievement)
- [ ] GET /api/v1/feed - chronological feed from connections, paginated (20 per page)
- [ ] GET /api/v1/feed/posts/:id - single post with comments
- [ ] DELETE /api/v1/feed/posts/:id - soft delete own post
- [ ] POST /api/v1/feed/posts/:id/like - like post (toggle)
- [ ] DELETE /api/v1/feed/posts/:id/like - unlike post
- [ ] POST /api/v1/feed/posts/:id/comments - add comment
- [ ] GET /api/v1/feed/posts/:id/comments - get comments with pagination
- [ ] GET /api/v1/users/:username/posts - get user's feed posts
- [ ] Frontend: Story bar (horizontal scroll with avatar rings), story viewer (full-screen tap-through), story creator, feed page with infinite scroll, post card component, create post modal, comment section, user posts tab on profile

## Technical Details
- Story expiration: node-cron running every 15min, DELETE FROM stories WHERE expires_at < NOW()
- Story grouping: query all non-expired stories from connections, group by user_id, order by latest
- Story ring: show colored ring if unseen stories exist (check story_views)
- Feed query: SELECT from feed_posts WHERE author_id IN (connection_ids) ORDER BY created_at DESC with cursor pagination
- Image uploads: presigned R2 URLs, store media in feed_post_media table with order_index
- Like toggle: INSERT on like, DELETE on unlike, update like_count via trigger or application logic
- Achievement posts: special post_type with badge styling in UI
- Socket.io event: story:new broadcast to connections when story created

## Dependencies
- [ ] Task 003: Authentication
- [ ] Task 004: Connections (feed shows posts from connections, stories from connections)
- [ ] Cloudflare R2 for image storage

## Effort Estimate
- Size: L
- Hours: 20-24
- Parallel: true (can run alongside Tasks 5, 7)

## Definition of Done
- [ ] Story creation (image + text) works
- [ ] Stories auto-expire after 24 hours
- [ ] Story viewer shows content with view tracking
- [ ] Feed posts (text/image) create and display correctly
- [ ] Like/comment system works
- [ ] Feed pagination via infinite scroll works
- [ ] Story bar displays with unseen indicators
