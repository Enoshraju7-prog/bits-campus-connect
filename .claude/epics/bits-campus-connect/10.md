---
name: Real-time Messaging
status: open
created: 2026-02-01T19:27:06Z
updated: 2026-02-01T19:36:29Z
github: https://github.com/Enoshraju7-prog/bits-campus-connect/issues/10
depends_on: [001, 002, 003]
parallel: true
conflicts_with: [008]
---

# Task: Real-time Messaging

## Description
Build the complete real-time messaging system with Socket.io for both 1:1 direct messages and group chats. Includes WebSocket server setup with JWT authentication, message CRUD, delivery/read status tracking, typing indicators, conversation management, and full chat UI.

## Acceptance Criteria
- [ ] Socket.io server integrated with Express, JWT auth on connection handshake
- [ ] Socket rooms per conversation (join on connect, leave on disconnect)
- [ ] POST /api/v1/conversations - create direct or group conversation
- [ ] GET /api/v1/conversations - list conversations with last message and unread count, sorted by recent activity
- [ ] GET /api/v1/conversations/:id - conversation details with participants
- [ ] GET /api/v1/conversations/:id/messages - paginated message history (cursor-based)
- [ ] POST /api/v1/conversations/:id/messages - send message (text/image), broadcast via Socket.io
- [ ] DELETE /api/v1/messages/:id - soft delete (delete for me / delete for everyone)
- [ ] POST /api/v1/conversations/:id/read - mark messages as read, broadcast read receipt
- [ ] PUT /api/v1/conversations/:id/mute - toggle mute for conversation
- [ ] Group chat: POST /api/v1/conversations/:id/members (add), DELETE (remove), PUT (update role)
- [ ] POST /api/v1/conversations/:id/leave - leave group
- [ ] WebSocket events: message:send, message:new, message:delivered, message:read, typing:start, typing:stop, user:typing
- [ ] Online/offline presence: user:online, user:offline events via Socket.io
- [ ] Frontend: Conversation list page, chat view with message bubbles, group info/members screen, new message composer, typing indicator UI
- [ ] Image messages via presigned R2 upload (max 10MB)

## Technical Details
- Socket.io namespace: default (/) with auth middleware
- Room naming: conversation:{id} for each conversation
- User room: user:{id} for personal notifications/presence
- Message delivery flow: sender emits -> server saves to DB -> server broadcasts to room -> recipients get message:new
- Read receipts: batch update on conversation open, broadcast to sender
- Typing indicators: debounced (2s timeout), only broadcast to other participants
- Unread count: stored in conversation_participants.last_read_at, computed on query
- Cursor-based pagination for messages (by created_at DESC)
- Group chat max 256 members, at least 1 admin at all times
- Redis for online user tracking (SET user:online:{id} with TTL)

## Dependencies
- [ ] Task 003: Authentication (JWT middleware for both REST and Socket.io)
- [ ] Task 002: Database (conversations, messages, participants tables)

## Effort Estimate
- Size: XL
- Hours: 24-32
- Parallel: true (can run alongside Tasks 4, 6, 7)

## Definition of Done
- [ ] 1:1 messaging works in real-time between two users
- [ ] Group chat creation and messaging works
- [ ] Message delivery and read status updates in real-time
- [ ] Typing indicators show/hide correctly
- [ ] Conversation list shows correct unread counts
- [ ] Online/offline presence tracked
- [ ] Chat UI is responsive and functional on mobile/desktop
